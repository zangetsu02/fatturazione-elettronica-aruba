---
title: XML Builder
description: Package @fatturazione-elettronica-aruba/xml-builder
---

# XML Builder

Costruzione, validazione e serializzazione fatture elettroniche FatturaPA.

## FatturaBuilder

Builder fluent per la costruzione di fatture.

```typescript
import { FatturaBuilder } from '@fatturazione-elettronica-aruba/xml-builder';

const builder = FatturaBuilder.create();
```

### Metodi

#### create()

Crea una nuova istanza del builder.

```typescript
const builder = FatturaBuilder.create();
```

#### setVersione(versione)

Imposta la versione dello schema (default: `'1.2.2'`).

```typescript
builder.setVersione('1.2.2');
```

#### setDatiTrasmissione(dati)

Imposta i dati di trasmissione completi.

```typescript
builder.setDatiTrasmissione({
  idTrasmittente: { idPaese: 'IT', idCodice: '01234567890' },
  progressivoInvio: '00001',
  formatoTrasmissione: 'FPR12',
  codiceDestinatario: 'ABC1234',
  pecDestinatario?: string,
  contattiTrasmittente?: { telefono?: string, email?: string },
});
```

#### setTrasmissioneB2B(params)

Helper per trasmissione B2B (formato FPR12).

```typescript
builder.setTrasmissioneB2B({
  idPaese: string;
  idCodice: string;
  progressivoInvio: string;
  codiceDestinatario?: string;  // Default: '0000000'
  pecDestinatario?: string;
});
```

#### setTrasmissionePA(params)

Helper per trasmissione PA (formato FPA12).

```typescript
builder.setTrasmissionePA({
  idPaese: string;
  idCodice: string;
  progressivoInvio: string;
  codiceDestinatario: string;   // Codice IPA 6 caratteri
});
```

#### setCedentePrestatore(cedente)

Imposta il cedente/prestatore (venditore).

```typescript
builder.setCedentePrestatore({
  datiAnagrafici: {
    idFiscaleIVA?: { idPaese: string, idCodice: string },
    codiceFiscale?: string,
    anagrafica: { denominazione?: string, nome?: string, cognome?: string },
    regimeFiscale: RegimeFiscale,
  },
  sede: Indirizzo,
  stabileOrganizzazione?: Indirizzo,
  iscrizioneREA?: IscrizioneREA,
  contatti?: Contatti,
  riferimentoAmministrazione?: string,
});
```

#### setCessionarioCommittente(cessionario)

Imposta il cessionario/committente (acquirente).

```typescript
builder.setCessionarioCommittente({
  datiAnagrafici: {
    idFiscaleIVA?: { idPaese: string, idCodice: string },
    codiceFiscale?: string,
    anagrafica: { denominazione?: string, nome?: string, cognome?: string },
  },
  sede: Indirizzo,
  stabileOrganizzazione?: Indirizzo,
  rappresentanteFiscale?: RappresentanteFiscale,
});
```

#### setDatiGenerali(dati)

Imposta i dati generali del documento.

```typescript
builder.setDatiGenerali({
  datiGeneraliDocumento: {
    tipoDocumento: TipoDocumento,
    divisa: string,           // Es: 'EUR'
    data: string,             // YYYY-MM-DD
    numero: string,
    importoTotaleDocumento?: number,
    causale?: string[],
    datiRitenuta?: DatiRitenuta,
    datiBollo?: DatiBollo,
  },
  datiOrdineAcquisto?: DatiDocumentoCorrelato[],
  datiContratto?: DatiDocumentoCorrelato[],
  datiDDT?: DatiDDT[],
});
```

#### setDatiBeniServizi(dati)

Imposta le linee di dettaglio e riepilogo IVA.

```typescript
builder.setDatiBeniServizi({
  dettaglioLinee: [
    {
      numeroLinea: number,
      descrizione: string,
      quantita?: number,
      unitaMisura?: string,
      prezzoUnitario: number,
      prezzoTotale: number,
      aliquotaIVA: number,
      natura?: Natura,
      scontoMaggiorazione?: ScontoMaggiorazione[],
    },
  ],
  datiRiepilogo: [
    {
      aliquotaIVA: number,
      imponibileImporto: number,
      imposta: number,
      natura?: Natura,
      esigibilitaIVA?: 'I' | 'D' | 'S',
      riferimentoNormativo?: string,
    },
  ],
});
```

#### addDatiPagamento(pagamento)

Aggiunge dati di pagamento.

```typescript
builder.addDatiPagamento({
  condizioniPagamento: 'TP01' | 'TP02' | 'TP03',
  dettaglioPagamento: [
    {
      modalitaPagamento: ModalitaPagamento,
      importoPagamento: number,
      dataScadenzaPagamento?: string,
      iban?: string,
      istitutoFinanziario?: string,
    },
  ],
});
```

#### newBody()

Finalizza il body corrente e inizia uno nuovo (per fatture lotto).

```typescript
builder
  .setDatiGenerali({ ... })
  .setDatiBeniServizi({ ... })
  .newBody()
  .setDatiGenerali({ ... })  // Nuova fattura
  .setDatiBeniServizi({ ... });
```

#### build()

Costruisce la fattura elettronica.

```typescript
const fattura: FatturaElettronica = builder.build();
```

#### reset()

Resetta il builder allo stato iniziale.

```typescript
builder.reset();
```

## FatturaValidator

Validatore per fatture elettroniche.

```typescript
import { FatturaValidator, validateFattura } from '@fatturazione-elettronica-aruba/xml-builder';

// Istanza
const validator = new FatturaValidator(options);
const result = validator.validate(fattura);

// Helper
const result = validateFattura(fattura, options);
```

### Opzioni

```typescript
interface ValidationOptions {
  validateTotals?: boolean;        // Default: true
  validateCodiceFiscale?: boolean; // Default: true
  validatePartitaIVA?: boolean;    // Default: true
  validateDates?: boolean;         // Default: true
  strict?: boolean;                // Default: false
}
```

### Risultato

```typescript
interface ValidationResult {
  valid: boolean;
  errors: ValidationError[];
  warnings: ValidationError[];
}

interface ValidationError {
  path: string;
  message: string;
  code: string;
}
```

## FatturaSerializer

Serializza fatture in XML.

```typescript
import { FatturaSerializer } from '@fatturazione-elettronica-aruba/xml-builder';

const serializer = new FatturaSerializer({
  includeSchemaLocation?: boolean,  // Default: true
});

const xml = serializer.serialize(fattura);
```

## Tipi

### TipoDocumento

```typescript
type TipoDocumento =
  | 'TD01' | 'TD02' | 'TD03' | 'TD04' | 'TD05' | 'TD06'
  | 'TD07' | 'TD08' | 'TD09' | 'TD10' | 'TD11' | 'TD12'
  | 'TD16' | 'TD17' | 'TD18' | 'TD19' | 'TD20' | 'TD21'
  | 'TD22' | 'TD23' | 'TD24' | 'TD25' | 'TD26' | 'TD27' | 'TD28';
```

### RegimeFiscale

```typescript
type RegimeFiscale =
  | 'RF01' | 'RF02' | 'RF04' | 'RF05' | 'RF06' | 'RF07'
  | 'RF08' | 'RF09' | 'RF10' | 'RF11' | 'RF12' | 'RF13'
  | 'RF14' | 'RF15' | 'RF16' | 'RF17' | 'RF18' | 'RF19';
```

### Natura

```typescript
type Natura =
  | 'N1' | 'N2' | 'N2.1' | 'N2.2'
  | 'N3' | 'N3.1' | 'N3.2' | 'N3.3' | 'N3.4' | 'N3.5' | 'N3.6'
  | 'N4' | 'N5' | 'N6' | 'N6.1' | 'N6.2' | 'N6.3' | 'N6.4'
  | 'N6.5' | 'N6.6' | 'N6.7' | 'N6.8' | 'N6.9' | 'N7';
```

### ModalitaPagamento

```typescript
type ModalitaPagamento =
  | 'MP01' | 'MP02' | 'MP03' | 'MP04' | 'MP05'
  | 'MP06' | 'MP07' | 'MP08' | 'MP09' | 'MP10'
  | 'MP11' | 'MP12' | 'MP13' | 'MP14' | 'MP15'
  | 'MP16' | 'MP17' | 'MP18' | 'MP19' | 'MP20'
  | 'MP21' | 'MP22' | 'MP23';
```

### Indirizzo

```typescript
interface Indirizzo {
  indirizzo: string;
  numeroCivico?: string;
  cap: string;
  comune: string;
  provincia?: string;
  nazione: string;
}
```
